sudo: required
dist: trusty

group: edge

# whitelist
branches:
  only:
    - master

notifications:
  irc:
    channels:
      - "irc.uvt.nl#gitlama"
    template:
      - "%{repository_slug}#%{build_number} %{message} --> %{build_url}"
    skip_join: true

language: cpp

matrix:
  include:
    - os: linux
      env:
        - MATRIX_EVAL="CC=gcc && CXX=g++"
      script:
        - git clone https://github.com/LanguageMachines/frogtests.git
        - cd frogtests
        - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
        - frog_bin=/usr/local/bin ./testall >&2

    - os: linux
      addons:
        apt:
          packages:
            - libiomp-dev
      env:
        - MATRIX_EVAL='CC=clang && CXX=clang++'
        - CXXFLAGS="-fopenmp=libiomp5"
# libiomp is a very strange abberation in trusty
# changed to libomp in newer Ubuntu versions.


    - os: linux
      addons:
        apt:
          sources:
            - llvm-toolchain-trusty-4.0
            - ubuntu-toolchain-r-test
          packages:
            - clang++-4.0
            - libiomp-dev
      env:
        - MATRIX_EVAL="CC=clang-4.0 && CXX=clang++-4.0"
        - CXXFLAGS="-fopenmp=libiomp5"

before_install:
    - sudo apt-get update
    - sudo apt-get install pkg-config autoconf-archive autotools-dev libicu-dev libxml2-dev libbz2-dev zlib1g-dev libtar-dev libboost-dev libboost-regex-dev expect
    - eval "${MATRIX_EVAL}"
    - echo $CC
    - echo $CXX
    - echo $CXXFLAGS
    - git clone https://github.com/LanguageMachines/ticcutils
    - cd ticcutils
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/libfolia
    - cd libfolia
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/uctodata
    - cd uctodata
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/ucto
    - cd ucto
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/timbl
    - cd timbl
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/mbt
    - cd mbt
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
    - git clone https://github.com/LanguageMachines/frogdata
    - cd frogdata
    - bash bootstrap.sh
    - ./configure
    - make
    - sudo make install
    - cd ..
install:
    - bash bootstrap.sh
    - if [ "$CXX" == "clang++" ]; then export CXXFLAGS="-O3 -fopenmp=libiomp5"; fi
    - echo $CXXFLAGS
    - ./configure
    - make
    - sudo make install
    - LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib make check

after_failure:
    - for file in *.diff; do echo DIFF in $file; cat $file; done
    - for file in *.err; do echo ERRORS in $file; cat $file; done
    - for file in *.log; do echo SERVER LOGS in $file; cat $file; done
